!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=19)}([function(e,t){e.exports=require("typedi")},function(e,t){e.exports=require("socket-controllers")},function(e,t){e.exports=require("reflect-metadata")},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("routing-controllers")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("db-migrate-shared")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("figlet")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("open")},function(e){e.exports={port:4e3,sqlite:"database.db",default:{destinations:[{receiver:"websocket",info:{}}]}}},function(e,t){e.exports=require("db-migrate-sqlite3")},function(e,t){e.exports=require("uid")},function(e,t){e.exports=require("ejs")},function(e,t,r){"use strict";r.r(t);r(2);var o,n=r(4),i=r(1),c=r(0),s=r(8),a=r.n(s),u=r(6),f=r.n(u),p=r(9),l=r.n(p),g=r(5),d=r(3),y=function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},h=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(){function e(){this.logger=Object(d.createLogger)({format:d.format.combine(d.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),Object(d.format)(function(e){return"error"===e.level?Object.assign({},e,{message:e.timestamp+" "+e.stack}):e})(),d.format.printf(function(e){var t=e.timestamp,r=e.level,o=e.message,n=e.meta;return n?t+" "+r+" ["+n.filename+":"+n.line+"]: "+o:t+" "+r+" "+o})),transports:[new d.transports.Console({level:"debug",handleExceptions:!0}),new d.transports.File({filename:"error.log",level:"error"}),new d.transports.File({filename:"system.log"})],exitOnError:!1})}return e.prototype.init=function(){this.logger.info("created LoggerSrv")},e.prototype.write=function(e,t){this.logger.info(e)},e.prototype.alert=function(e,t){void 0===t&&(t=3),this.logger.alert(e)},e.prototype.crit=function(e,t){void 0===t&&(t=3),this.logger.crit(e)},e.prototype.data=function(e,t){void 0===t&&(t=3),this.logger.data(e)},e.prototype.debug=function(e,t){void 0===t&&(t=3),this.logger.debug(e)},e.prototype.error=function(e,t){void 0===t&&(t=3),this.logger.error(e)},e.prototype.help=function(e,t){void 0===t&&(t=3),this.logger.help(e)},e.prototype.input=function(e,t){void 0===t&&(t=3),this.logger.input(e)},e.prototype.info=function(e,t){void 0===t&&(t=3),this.logger.info(e)},e.prototype.log=function(e,t,r){void 0===r&&(r=3),this.logger.log(e,t)},e.prototype.notice=function(e,t){void 0===t&&(t=3),this.logger.notice(e)},e.prototype.sql=function(e,t){void 0===t&&(t=3),this.debug(e,t)},e.prototype.prompt=function(e,t){void 0===t&&(t=3),this.logger.prompt(e)},e.prototype.silly=function(e,t){void 0===t&&(t=3),this.logger.silly(e)},e.prototype.verbose=function(e,t){void 0===t&&(t=3),this.logger.verbose(e)},e.prototype.warn=function(e,t){void 0===t&&(t=3),this.logger.warn(e)},e.prototype.warning=function(e,t){void 0===t&&(t=3),this.logger.warning(e)},e=y([Object(c.Service)(),h("design:paramtypes",[])],e)}(),m=function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},S=function(){function e(e){this.logger=e,this.logger.info("created SettingSrv"),this.settings=this.loadSettingFile()}return e.prototype.init=function(){return Promise.resolve()},e.prototype.uid=function(e){return e=e||7,Math.random().toString(35).substr(2,e)},e.prototype.loadSettingFile=function(){return r(15)},e.prototype.getPort=function(){return this.settings.port},e.prototype.getSystemDbName=function(){return this.settings.sqlite},e.prototype.getSettings=function(){return this.settings},e=m([Object(c.Service)(),b("design:paramtypes",[v])],e)}(),O=function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},j=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},R=function(){function e(e){this.logger=e,this.sockets={},this.logger.info("created SocketMangerSrv")}return e.prototype.init=function(){return Promise.resolve()},e.prototype.addSocket=function(e){var t=e.id;this.sockets[t]=e,this.logger.info("registerd "+t)},e.prototype.delSocket=function(e){this.logger.info("unregisterd "+e),delete this.sockets[e]},e.prototype.getSocket=function(e){return this.sockets[e]},e.prototype.isExistSocket=function(e){return!!this.sockets[e]},e.prototype.getAll=function(){return this.sockets},e.prototype.emitAll=function(e,t){for(var r in this.sockets){this.sockets[r].emit(e,t)}},e=O([Object(c.Service)(),j("design:paramtypes",[v])],e)}(),w=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),k=function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},M=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=r(16),_=r(7).dataType,C=function(e){function t(t,r){var o=e.call(this)||this;return o.loggerService=t,o.settingSrv=r,o.loggerService.info("created StorageSrv"),o.dbname=o.settingSrv.getSystemDbName(),o}return w(t,e),t.prototype.init=function(){var e=this;return new Promise(function(t,r){e.connect(e.dbname).then(function(r){e.db=r,e.loggerService.info("Connected to the "+e.dbname+" database."),t()},function(e){r(e)})})},t.prototype.connect=function(e){var t=this;return this.loggerService.info("try load sqlite : "+e),this.loggerService.sql=this.sqlLogger.bind(this),new Promise(function(e,r){var o={mod:{log:t.loggerService,type:_},interfaces:{SeederInterface:{},MigratorInterfrace:{}}},n={driver:"sqlite3",filename:t.dbname};P.connect(n,o,function(t,o){t?r(t):(o.all("PRAGMA foreign_keys=ON"),e(o))})})},t.prototype.sqlLogger=function(){},t=k([Object(c.Service)(),M("design:paramtypes",[v,S])],t)}(g.EventEmitter),U=function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},x=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},I=function(){function e(e){this.logSrv=e,this.userCache={}}return e.prototype.init=function(){this.logSrv.info("created UserService")},e.prototype.addUser=function(e,t){return this.getUserIdByName(t)?(this.logSrv.info("already used user id"),!1):(this.userCache[e]=t,this.logSrv.info("Logined New User : "+t),!0)},e.prototype.removeUser=function(e){var t=this.getUsernameById(e);delete this.userCache[e],this.logSrv.info("Logout User : "+t)},e.prototype.getUsernameById=function(e){return this.userCache[e]},e.prototype.getUserIdByName=function(e){for(var t in this.userCache)if(e===this.userCache[t])return t;return null},e.prototype.getUsers=function(){return this.userCache},e=U([Object(c.Service)(),x("design:paramtypes",[v])],e)}(),q=function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},D=function(){function e(e,t){this.loggerService=e,this.userService=t,this.listCache={}}return e.prototype.init=function(){this.loggerService.info("created RoomService")},e.prototype.addRoom=function(e,t,r){this.listCache[e]={name:t,creator:r,users:{}}},e.prototype.getRooms=function(e){return e?this.getRoomByUserId(e):this.listCache},e.prototype.getRoomByUserId=function(e){var t={};for(var r in this.listCache)for(var o in this.listCache[r].users)o===e&&(t[r]=this.listCache[r]);return t},e.prototype.getRoom=function(e){for(var t in this.listCache)if(e===t)return this.listCache[t];return null},e.prototype.loginUser=function(e,t){var r=this.getRoom(e),o=this.userService.getUsernameById(t);return!(!t||!r)&&(r.users[t]=o,this.loggerService.info("["+r.name+"] Chat room logined "+o),!0)},e.prototype.loginUsers=function(e,t){for(var r=0,o=t;r<o.length;r++){var n=o[r];this.loginUser(e,n)}},e.prototype.logoutUser=function(e,t){var r=this.getRoom(e);return!(!t||!r)&&(delete r.users[t],!0)},e.prototype.logoutRoom=function(e){var t=this.getRoomByUserId(e);for(var r in t)this.logoutUser(r,e)},e.prototype.isExistUser=function(e,t){var r=this.getRoom(e);if(r)for(var o in r.users)if(o===t)return!0;return!1},e=q([Object(c.Service)(),E("design:paramtypes",[v,I])],e)}(),T=function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},B=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},N=(function(){function e(e){this.loggerSrv=e,this.loggerSrv.info("created RootController")}e.prototype.helloServer=function(){},T([Object(n.Get)("/"),Object(n.Render)("index.html"),B("design:type",Function),B("design:paramtypes",[]),B("design:returntype",void 0)],e.prototype,"helloServer",null),e=T([Object(n.Controller)(""),B("design:paramtypes",[v])],e)}(),function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c}),F=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},A=function(e,t){return function(r,o){t(r,o,e)}},L=r(17),G=function(){function e(e,t,r,o){this.sockMgrSrv=e,this.userSrv=t,this.roomSrv=r,this.loggerSrv=o,this.loggerSrv.info("created WsMessageController")}return e.prototype.connection=function(e){this.sockMgrSrv.addSocket(e),this.loggerSrv.info("new socket client connected"),this.userSrv.getUsernameById(e.id)&&e.emit("room",this.roomSrv.getRooms(e.id))},e.prototype.disconnect=function(e){var t=e.id;this.roomSrv.logoutRoom(t),this.userSrv.removeUser(t),this.sockMgrSrv.emitAll("users",this.userSrv.getUsers()),this.sockMgrSrv.delSocket(t)},e.prototype.addUser=function(e,t){var r=t.name,o=this.userSrv.addUser(e.id,r);o&&this.sockMgrSrv.emitAll("users",this.userSrv.getUsers()),e.emit("login",o?r:null),e.emit("room",this.roomSrv.getRooms(e.id))},e.prototype.getRoom=function(e){this.userSrv.getUsernameById(e.id)?e.emit("room",this.roomSrv.getRooms(e.id)):e.emit("room",null)},e.prototype.addRoom=function(e,t){var r=L(),o=this.userSrv.getUsernameById(e.id);this.roomSrv.addRoom(r,t.name,o),this.roomSrv.loginUser(r,e.id),e.emit("room",this.roomSrv.getRooms(e.id))},e.prototype.roomMessage=function(e,t){var r=t.roomId,o=t.type,n=t.message,i=this.roomSrv.getRoom(r),c=this.userSrv.getUsernameById(e.id);if(i)for(var s in i.users){var a={username:c,type:o,message:n,isMy:s===e.id,date:new Date};this.sockMgrSrv.getSocket(s).emit("room/message",a)}},e.prototype.inviteUser=function(e){var t=e.roomId,r=e.users;this.roomSrv.loginUsers(t,r);for(var o=0,n=r;o<n.length;o++){var i=n[o];this.sockMgrSrv.getSocket(i).emit("room",this.roomSrv.getRooms(i))}},e.prototype.getUsers=function(e){var t=this.userSrv.getUsernameById(e.id)?this.userSrv.getUsers():null;e.emit("users",t)},N([Object(i.OnConnect)(),A(0,Object(i.ConnectedSocket)()),F("design:type",Function),F("design:paramtypes",[Object]),F("design:returntype",void 0)],e.prototype,"connection",null),N([Object(i.OnDisconnect)(),A(0,Object(i.ConnectedSocket)()),F("design:type",Function),F("design:paramtypes",[Object]),F("design:returntype",void 0)],e.prototype,"disconnect",null),N([Object(i.OnMessage)("login"),A(0,Object(i.ConnectedSocket)()),A(1,Object(i.MessageBody)()),F("design:type",Function),F("design:paramtypes",[Object,Object]),F("design:returntype",void 0)],e.prototype,"addUser",null),N([Object(i.OnMessage)("room"),A(0,Object(i.ConnectedSocket)()),F("design:type",Function),F("design:paramtypes",[Object]),F("design:returntype",void 0)],e.prototype,"getRoom",null),N([Object(i.OnMessage)("room/new"),A(0,Object(i.ConnectedSocket)()),A(1,Object(i.MessageBody)()),F("design:type",Function),F("design:paramtypes",[Object,Object]),F("design:returntype",void 0)],e.prototype,"addRoom",null),N([Object(i.OnMessage)("room/message"),A(0,Object(i.ConnectedSocket)()),A(1,Object(i.MessageBody)()),F("design:type",Function),F("design:paramtypes",[Object,Object]),F("design:returntype",void 0)],e.prototype,"roomMessage",null),N([Object(i.OnMessage)("room/invite"),A(0,Object(i.MessageBody)()),F("design:type",Function),F("design:paramtypes",[Object]),F("design:returntype",void 0)],e.prototype,"inviteUser",null),N([Object(i.OnMessage)("users"),A(0,Object(i.ConnectedSocket)()),F("design:type",Function),F("design:paramtypes",[Object]),F("design:returntype",void 0)],e.prototype,"getUsers",null),e=N([Object(i.SocketController)("/chat"),F("design:paramtypes",[R,I,D,v])],e)}(),Y=function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},V=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},H=r(7).dataType,X=function(){function e(e,t){this.logger=e,this.storageSrv=t,this.tableName="migration_log",this.logger.info("created Migration_logRepository")}return e.prototype.init=function(){return Promise.resolve()},e.prototype.migrations=function(){var e=this;return[{migration_id:"create table migration_log",action:"createTable",args:[this.tableName,{id:{type:H.INTEGER,primaryKey:!0,autoIncrement:!0,notNull:!0},migration_id:{type:H.STRING,length:255},action:{type:H.STRING,notNull:!0,length:20},params:{type:H.TEXT,notNull:!0,defaultValue:""},success:{type:H.BOOLEAN,notNull:!0},error:{type:H.TEXT,defaultValue:""},timestamp:{type:H.DATE_TIME,defaultValue:new String("CURRENT_TIMESTAMP")}},function(t){t&&e.logger.error(t)}]}]},e.prototype.getMigrationLog=function(){var e=this;return new Promise(function(t){e.storageSrv.db.all("select * from migration_log",function(e,r){t(e?[]:r)})})},e=Y([Object(c.Service)(),V("design:paramtypes",[v,C])],e)}(),z=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),J=function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c},K=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},W=function(e){function t(t,r,o){var n=e.call(this)||this;return n.logger=t,n.storageSrv=r,n.migrationLogRepository=o,n.migrations=[],n.logger.info("created StorageMigrationSrv"),n}return z(t,e),t.prototype.init=function(){var e=this,t={};return this.migrationLogRepository.getMigrationLog().then(function(e){for(var r=0,o=e;r<o.length;r++){var n=o[r];n.success&&(t[n.migration_id]=n)}return t}).then(function(t){e.addMigrations(),e.dbMigration(t)})},t.prototype.addMigration=function(e,t,r){this.migrations.push({migration_id:e,action:t,args:r})},t.prototype.addMigrations=function(){for(var e=0,t=[this.migrationLogRepository.migrations()];e<t.length;e++){var r=t[e];this.migrations=this.migrations.concat(r)}},t.prototype.dbMigration=function(e){for(var t=this,r=function(r,n,i){if(!e[r]){o.logger.info("execute "+r);var c=i[i.length-1];i[i.length-1]=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var s=e[0],a=!s,u=s?s.message.replace(/\"/gi,"'"):"",f=JSON.stringify(i.slice(0,i.length-1)).replace(/\"/gi,"'"),p=t.storageSrv.db;p.insert("migration_log",["migration_id","action","success","error","params"],[r,n,a,u,f],function(e){e&&t.logger.error(e)}),c.apply(t.storageSrv.db,e)};try{o.storageSrv.db[n].apply(o.storageSrv.db,i)}catch(e){o.logger.error(e)}}},o=this,n=0,i=this.migrations;n<i.length;n++){var c=i[n];r(c.migration_id,c.action,c.args)}},t=J([Object(c.Service)(),K("design:paramtypes",[v,C,X])],t)}(g.EventEmitter),Q=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Z=function(e,t,r,o){return new(r||(r=Promise))(function(n,i){function c(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(c,s)}a((o=o.apply(e,t||[])).next())})},$=function(e,t){var r,o,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},ee=r(10),te=r(11),re=r(12),oe=r(13);r(14);new(function(e){function t(t){var o=this,s=oe.join("dist","public");o=e.call(this)||this,Object(n.useContainer)(c.Container),Object(i.useContainer)(c.Container),o.app=f()(),o.app.use(re()),o.app.engine("html",r(18).renderFile),o.app.set("views",oe.join(s)),o.app.set("view engine","html"),Object(n.useExpressServer)(o.app),o.server=a.a.createServer(o.app),o.app.use("/public",f.a.static(s)),o.io=l()(o.server),Object(i.useSocketServer)(o.io,{controllers:[G]});var u=c.Container.get(v);return u.info("\n"+te.textSync("Sample")),o.app.use(ee("combined",{stream:u})),o.addServices(),o.port=t?parseInt(t,10):c.Container.get(S).getPort(),o}return Q(t,e),t.prototype.addMiddleware=function(e){this.app.use(e)},t.prototype.addServices=function(){return Z(this,void 0,void 0,function(){var e,t,r,o,n,i,s,a,u,f,p;return $(this,function(l){switch(l.label){case 0:for(e=[{name:"socketIO",instance:this.io}],t=c.Container.get(v),r=0,o=e;r<o.length;r++)i=(n=o[r]).name,f=n.instance,c.Container.set(i,f),t.info("[init] DI Registered "+i);s=0,a=[S,C,W,I,D,R],l.label=1;case 1:if(!(s<a.length))return[3,6];u=a[s],l.label=2;case 2:return l.trys.push([2,4,,5]),[4,(f=c.Container.get(u)).init()];case 3:return l.sent(),t.info("[Serivce Initialize] DI Registered "+u.name),[3,5];case 4:return p=l.sent(),console.log(p.stack),t.error(p),[3,5];case 5:return s++,[3,1];case 6:return this.emit("ready"),[2]}})})},t.prototype.getApp=function(){return this.app},t.prototype.runServ=function(){var e=this,t=c.Container.get(v);return new Promise(function(r){e.once("ready",function(){return Z(e,void 0,void 0,function(){var e=this;return $(this,function(o){return r(this.server.listen(this.port,function(){return t.info("listening on port "+e.port)})),[2]})})})})},t}(g.EventEmitter))(process.env.PORT).runServ()}]);
//# sourceMappingURL=server.bundle.js.map